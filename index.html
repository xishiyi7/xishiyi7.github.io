<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="this is my personal post">
<meta property="og:type" content="website">
<meta property="og:title" content="阿根廷人。">
<meta property="og:url" content="https://github.com/xishiyi7/xishiyi7.github.io/index.html">
<meta property="og:site_name" content="阿根廷人。">
<meta property="og:description" content="this is my personal post">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阿根廷人。">
<meta name="twitter:description" content="this is my personal post">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'hide',
    motion: true
  };
</script>

  <title> 阿根廷人。 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?ba79b70fc8075ea38398e9197ab4fc9e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">阿根廷人。</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">xishiyi7</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <section id="posts" class="posts-expand">

    

    
    

    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/03/angular项目涉及多个应用的目录结构划分参考/" itemprop="url">
                  angular项目涉及多个应用的目录结构划分参考
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-06-03T14:26:31+08:00" content="2016-06-03">
              2016-06-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/06/03/angular项目涉及多个应用的目录结构划分参考/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/03/angular项目涉及多个应用的目录结构划分参考/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一般的angular项目都是单页应用，但是当项目逐渐庞大时，可能会需要拆分多个应用来具体实现。近期花时间将原有的项目结构进行改造，以便进行多应用开发，下图是我设计的初版项目目录结构，希望可以给有需要的人一点帮助。</p>
<p><code class="normal-img"><img src="../../../../images/20160603/structure.png" alt="structure"></code></p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/29/关于登录页面的一些事儿/" itemprop="url">
                  你以为BAT的登录天衣无缝?
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-04-29T14:32:12+08:00" content="2016-04-29">
              2016-04-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/04/29/关于登录页面的一些事儿/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/29/关于登录页面的一些事儿/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p><strong><small style="font-weight:100;color:rgba(255,128,0,1)">以下皆为个人原创见解，不当之处烦请指正。</small></strong></p>
<p>首先，我有些话想说在前面。现在网上的各种开放的资源，很多都是有访客模式，即不用登录也能浏览或者操作，但是现今时代没有登录功能或者登录页面的网站，几乎绝迹了。<br>说实话，登录页面除了验证信息作用外，其他的都不是主要的，因此可能很多人觉得没有必要花很多时间在这上面。<br>我也同意上述观点！<br>但是呢，既然做了，当然希望做的更好点啦，废话不说，下面进入主题。</p>
<h3 id="吐槽">吐槽</h3><p>各大公司的网站，做的已经非常棒了，至少我是很佩服。<br>但是有时候会遇到一点小瑕疵，比如说下面几个例子，我平时也会拿出来吐槽下，用以慰藉下像我这种技术渣幼小的心灵。</p>
<ul>
<li><strong><em>JD</em></strong></li>
</ul>
<ol>
<li>JD的登录页面，如果没输入用户名和密码，或者只输入密码，点击登录按钮，会请求服务器拿两个log.gif文件，我并不知道这个文件是干嘛用的，为什么要这么做。然后当输入了用户名再删去，也会发出请求。不是应该只有都输了，才发出请求的吗???<hr style="background-color:#CFE8A8;margin:5px 0;"></li>
<li>第二点，就是点击右下角扫码登录后，按钮居然跑下面来了，居然不是在同一个地方，每次点完都要移动鼠标才能点回去，这体验太差了吧。<hr style="background-color:#CFE8A8;margin:5px 0;"></li>
<li>第三点，从普通登录切换扫码登录，拿一个code图片，我能理解，但是为什么切回来的时候，还要拿一次吖？？？<hr style="background-color:#CFE8A8;margin:5px 0;"></li>
<li>第四点，登录页面没有做自适应处理，缩放后出现滚动条。</li>
</ol>
<ul>
<li><strong><em>BD</em></strong><br>BD的登录弹框，每次修改完密码再失焦，会请求一次publicKey。然后从扫码登录页面切换回来，也还会再请求一次gif文件。但至少切换的按钮，位置没变，不需要再移动鼠标。也没有做自适应处理，缩放屏幕出现滚动条。</li>
<li><strong><em>ALI</em></strong></li>
</ul>
<ol>
<li>TB的登录页面做了自适应，有一个767的分界。屏宽小于767px，会让登录窗口居中显示，去掉背景。<br>但是关于TB登录页面的自适应做的，也有问题。当屏宽超过767px时，由于其左边的背景看着像是广告图片，图片的宽度设置为屏宽100%，而整个页面内容区域宽度也是固定的，目前是1200px，当屏宽在767与1200之间时，还是出现了横向滚动条。<br>关键的来了，由于TB登录框的position是relative，此时被固定在右侧了，你要看到首先得拖动滚动条，一拖滚动条，背景就跟不过来了，就会很容易出现我看到登录框整个背景是白色的！<br>或者部分背景是白色的！没有背景！或者说脱离背景图片了！这个看着视觉效果太差了感觉。<hr style="background-color:#CFE8A8;margin:5px 0;"></li>
<li>第二点，当我输入用户名和密码后，不管我有没有拖动验证条，都会去执行登录请求服务器。而且我很奇怪的是，登录失败也要整个页面重新刷新一次！！！<br>我的天呐，我不知道为什么需要重新刷新一次，而且我感觉好像是有意为之，因为登录失败再加载页面很慢，还有专门的加载进度圈圈。。。</li>
</ol>
<h3 id="界面">界面</h3><p>吐槽完了，说下我自己写的渣渣页面吧。由于h5很多元素用的不多，语义性可能有点乱，但是大致思想在那。<br>首先界面，主要是三块，header、section及footer，大致如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--login header--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">header</span> <span class="attribute">class</span> = "<span class="attribute">login-header</span>"&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!--login logo--&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-logo</span>"&gt;</span></span><br><span class="line">		...</span><br><span class="line">	  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--login content--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">section</span> <span class="attribute">class</span> = "<span class="attribute">login-content</span>"&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--login background--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-bg</span>"&gt;</span></span><br><span class="line">  	...</span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--login layout--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-layout</span>"&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-box-wrap</span>"&gt;</span></span><br><span class="line">		...</span><br><span class="line">	<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">section</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--login footer--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">footer</span> <span class="attribute">class</span> = "<span class="attribute">login-footer</span>"&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="title">footer</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>header部分现在是放一个logo区域。<br>footer部门现在是放一些友链啥的。<br>section是主要内容区域。内容区域放一个可以独立出来的弹出框，因为有些网站，像BD，可能不光有登录页面，还有登录弹框。<br>单独拿出来可以保证此页面可以复用，比如项目是用ng开发的时候，写成指令。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-box</span>"&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-box-content</span>"&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--login quick--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-quick</span>"&gt;</span></span><br><span class="line">    	...</span><br><span class="line">    <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--login static form--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">form</span> <span class="attribute">class</span> = "<span class="attribute">login-static</span>" <span class="attribute">submit</span> = "<span class="attribute">signIn</span>();"&gt;</span></span><br><span class="line">    	... (账户)</span><br><span class="line">    	... (密码)</span><br><span class="line">    	... (验证码)</span><br><span class="line">      <span class="comment">&lt;!--login button--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span> = "<span class="attribute">login-btn</span>"&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">button</span> <span class="attribute">type</span> = "<span class="attribute">submit</span>" <span class="attribute">class</span> = "<span class="attribute">btn</span> <span class="attribute">btn-success</span>"&gt;</span>登 录<span class="tag">&lt;/<span class="title">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="自适应&amp;视效(样式)">自适应&amp;视效(样式)</h3><p>可能不算视效啦，只是不知道怎么描述。<br>首先，内容区域，即section部分，我设置position为relative，相对定位。宽度100%。背景图片宽度100%，绝对定位。<br>添加媒介查询，屏宽小于768px时，背景不要了。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.login-content</span> &#123;</span><br><span class="line">       <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">       <span class="attribute">position</span>: relative;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="at_rule">@media</span> (<span class="attribute">min-width</span>: <span class="number">768px</span>)</span><br><span class="line">   .login-bg&#123;</span><br><span class="line">       <span class="attribute">position</span>: absolute;</span><br><span class="line">       <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>然后登录内容区域，宽度先固定1200px，相对定位。先保证在大屏幕情况下，正常显示，再去滚动条。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.login-layout</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">1200px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span> auto</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">overflow</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">transition</span>:<span class="value"> width .<span class="number">25s</span> linear</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>注意最后一行，我还加了点别的东西–transition，这个小过渡主要是变化窗体宽度的时候触发。<br>有人会说我width固定了，也触发不了呀，下面还有一点东西。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@media</span> (<span class="attribute">max-width</span>: <span class="number">1200px</span>) and (<span class="attribute">min-width</span>: <span class="number">768px</span>)</span><br><span class="line">   .login-layout &#123;</span><br><span class="line">       <span class="attribute">width</span>: <span class="number">100%</span>!important;</span><br><span class="line">  	&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面这句样式的作用就是用来动态改变登录内容区域宽度的。这句样式个人感觉还是蛮重要的，可以保证屏宽在这两者之间时，内容区域宽度动态变化，这样做的好处就在于里面的子元素相对其定位时，感觉上子元素所处的位置没有发生变化。<br>接下来看下登录框的样式。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.login-box-wrap</span> <span class="rules">&#123;</span><br><span class="line">       <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">40px</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">15%</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>相对父元素(此处为登录内容区域)，加一个top和right，以保证在宽度变化的时候，视觉上看登录框所处位置不变。<br>以上样式生效后，可以保证屏宽在768px以下时，只居中显示登陆框，在1200px以上时，正常显示。在两者之间时，屏宽有变化则登录窗体也跟着一起变化，不出现滚动条，背景不丢失，且登录框所处位置相对固定。</p>
<h3 id="登录(功能)">登录(功能)</h3><p>h5提供一些基础的表单校验功能，其中有一条–必填检验(required)。而且允许用户自定义一些校验提示，还支持正则匹配。此特性规定，在校验不合法的情况下，不允许用户提交表单。<br>因此我在form内利用这些新知识，可以避免在没有输入用户及密码的情况下，进行表单提交，请求后台服务器。我不知道其他网站为何要在未输入用户名密码的情况下请求后台服务器，我觉得在我看来没有这个必要。<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;input <span class="class"><span class="keyword">type</span> =</span> <span class="string">"text"</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> =</span> <span class="string">"form-control"</span> required autofocus = <span class="string">"autofocus"</span></span><br><span class="line">	autocomplete=<span class="string">"on"</span> placeholder = <span class="string">"手机号/会员名/邮箱"</span></span><br><span class="line">    oninvalid = <span class="string">"setCustomValidity('请输入账号')"</span></span><br><span class="line">    oninput = <span class="string">"setCustomValidity('')"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<p>‘autofocus’属性可以让当前元素在页面初始化的时候，自动获取焦点。<br>‘autocomplete’设置为on可以让浏览器记住输入内容。<br>‘oninvalid’属性可以自己设定输入非法时的提示语。<br>‘oninput’属性表示输入时要执行的操作。<br>‘placeholder’属性表示占位时显示的字符。</p>
<p>这些都是普通的h5新特性，可以添加你们适用的属性来满足需求，个人感觉还比较方便。</p>
<h3 id="安全">安全</h3><p>目前登录机制是利用cookie。有时候可能需要跳转到当前系统，即利用单点登录验证身份，此时是请求服务器产生一个唯一的一次可用的authId，携带这个authId的即视为合法用户。登录安全这块内容东西太多，做的时候需要考虑仔细点，以上就是登录页面我个人的看法。</p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/01/高性能网站建设指南-笔记/" itemprop="url">
                  高性能网站建设指南(笔记)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-04-01T10:52:53+08:00" content="2016-04-01">
              2016-04-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/04/01/高性能网站建设指南-笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/01/高性能网站建设指南-笔记/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>本文为Steve Souders的《High Performance Web Sites》读书笔记，主要介绍14条用于前端优化网站性能的建议。</p>
<h3 id="Rule_1:_Make_Fewer_HTTP_Requests(减少HTTP请求)">Rule 1: Make Fewer HTTP Requests(减少HTTP请求)</h3><ul>
<li><strong><em>Image Maps</em></strong><br>在看到这个名词之前，甚至没听说过它。稍微了解了下，知道大概就是可以用一张图片当成地图，然后点击图片上某一点，触发相应的事件。用到的场景可以是电商的服装广告上，比如一张模特图片，点击衣服，跳转衣服链接，点击鞋子，跳转鞋子链接。也可以是导航为图片的情况，点击导航对应的信息，相应执行动作。<br>使用图片地图可以减少多张图片进行多次HTTP请求。<br><a href="http://stevesouders.com/hpws/imagemap-no.php" target="_blank" rel="external">example for no</a><br><a href="http://stevesouders.com/hpws/imagemap.php" target="_blank" rel="external">example for yes</a></li>
<li><strong><em>CSS Sprites</em></strong><br>这个比较常用在图片图标情况下。<br><a href="http://stevesouders.com/hpws/sprites.php" target="_blank" rel="external">example for yes</a></li>
<li><strong><em>Inline Images</em></strong><br>可以使用“data:”内联图片，不用额外再去请求图片。<br><a href="http://stevesouders.com/hpws/inline-images.php" target="_blank" rel="external">example for html yes</a><br><a href="http://stevesouders.com/hpws/inline-css-images.php" target="_blank" rel="external">example for css yes</a></li>
<li><strong><em>Combined Scripts and Stylesheets</em></strong><br>可以使用一些工具，如webpack/gulp，将脚本合并，样式表合并。虽然两者还可以合并，但不建议这么做。<br><a href="http://stevesouders.com/hpws/combo-none.php" target="_blank" rel="external">example for no</a><br><a href="http://stevesouders.com/hpws/combo.php" target="_blank" rel="external">example for yes</a></li>
</ul>
<h3 id="Rule_2:_Use_a_Content_Delivery_NetWork(使用内容分发网络)">Rule 2: Use a Content Delivery NetWork(使用内容分发网络)</h3><ul>
<li><strong><em>CND</em></strong><br>先要了解下CND–内容分发网络。它是一组分布在多个不同地理位置的Web服务器，可以更加有效的向用户发布内容。个人感觉最简单的解释就是可以让用户就近请求资源。</li>
</ul>
<h3 id="Rule_3:_Add_an_Expires_Header(添加Expires头)">Rule 3: Add an Expires Header(添加Expires头)</h3><ul>
<li><strong><em>Expires</em></strong><br>Web服务器使用Expires来告诉客户端该资源在某时间之前是有效的。客户端在服务端没有更新资源的情况下，可以在这段时间内一直使用之前请求到的资源的副本。</li>
<li><strong><em>Max-Age &amp; mod_expires</em></strong><br>使用Expires有一些限制，比如需要客户端和服务端的时钟需要严格同步，然后还要经常检查过期日期，一旦过期，还得提供一个新的日期。<br>在HTTP1.1种，引入了Cache-Control。这时我们可以换一种方式，使用Cache-Control的Max-Age替代Expires。它表示资源可以被缓存多长时间，以s为单位。<br>为了兼容，可以同时指定这两个响应头。HTTP规范规定，如果这两者同时存在，Max-Age将重写Expires。</li>
<li><strong><em>Empty Cache vs Primed Cache</em></strong><br>如果你的页面中可缓存资源都在缓存中，则缓存是“完整的”。如果你页面中的资源没有放在缓存中，则缓存为“空”。这两者使用场景不一样，使用时，视情况而定。</li>
<li><strong><em>More Than Just Images</em></strong><br>图片添加Expires很正常，我们也应该给其他不经常变化的资源添加Expires，比如脚本、样式表等。</li>
<li><strong><em>Revving FileNames</em></strong><br>如果像上面那样给资源添加Expires，那么怎样让其获取更新呢？一般的实现是替换文件名，加一个版本信息后缀。</li>
</ul>
<h3 id="Rule_4:_Gzip_Components(压缩组件)">Rule 4: Gzip Components(压缩组件)</h3><ul>
<li><strong><em>How Cpmpression Works</em></strong><br>Web客户端可以通过HTTP请求中的Accept-Encoding头来标识对压缩的支持。如果Web服务器看到请求中的这个头，就会使用客户端列出来所支持的一种压缩方法来响应。<br>Web服务器通过响应中的Content-Encoding头来通知Web客户端。gzip是目前最流行和最有效的压缩方法，还有一种较普遍的压缩格式为deflate。支持deflate的浏览器也支持gzip，但支持gzip的浏览器却不一定支持deflate。</li>
</ul>
<h3 id="Rule_5:_Put_Stylesheets_at_the_Top(将样式表放在顶部)">Rule 5: Put Stylesheets at the Top(将样式表放在顶部)</h3><ul>
<li><strong><em>Progressive Rendering</em></strong><br>将样式表放在文档底部时，浏览器会延迟显示任何可视化的组件，这带来了很糟糕的用户体验，有时甚至会带来“白屏”现象。一般我们把样式表都放在文档的顶部。</li>
<li><strong><em>Flash of Unstyled Content</em></strong><br>“白屏”现象源自于浏览器的行为。“FOUC”–“无样式内容的闪烁”，简单说就是当样式加载完成，某组件会突然加载上某个样式，出现闪烁现象。<br>“白屏”现象是浏览器在尝试修改前端工程师所犯的错误–延迟呈现。</li>
<li><strong><em>What’s a Frontend Engineer to do?</em></strong><br>如何避免“白屏”和“FOUC”现象呢？<br>最佳的解决方案是遵循HTML规范，将样式表放在顶部。如果你的样式表不要求呈现页面，可以想办法在文档加载完毕后动态的加载进来，即“加载后下载”。</li>
</ul>
<h3 id="Rule_6:_Put_Scripts_at_the_Bottom(将脚本放在底部)">Rule 6: Put Scripts at the Bottom(将脚本放在底部)</h3><ul>
<li><strong><em>Parallel Downloads</em></strong><br>对响应时间影响最大的是页面中组件的数量。浏览器可并行下载组件数量有限，可能4个，可能8个。修改浏览器设置可能可以增加并行下载数量。但这个取决于你的带宽和CPU速度，过多的并行下载可能反而会降低性能。</li>
<li><strong><em>Scripts Block Downloads</em></strong><br>在下载脚本时，浏览器会阻塞并行下载。其中一个原因就是为了保证脚本能够按照正确的顺序执行。另一个原因是脚本可能使用document.write来修改页面内容，因此浏览器会等待，以确保页面能够恰当的布局。</li>
<li><strong><em>Worst Case: Scripts at the Top</em></strong><br>如果将脚本放在页面顶部，页面中的所有东西都位于脚本之后，那么整个页面的呈现和下载都会被阻塞，直至脚本加载完毕。</li>
<li><strong><em>Best Case: Scripts at the Bottom</em></strong><br>将脚本放在页面的底部是最佳的方案，既不会阻止页面内容的呈现，还可以让页面中的可视化组件尽早下载。</li>
<li><strong><em>Putting it in Perspective</em></strong><br>如果某个脚本下载等待时间很长，但我们不想等待这么长时间。那么可以使用Defferred(延迟)脚本。DEFER属性表明脚本不包含document.write，浏览器可以继续呈现。</li>
</ul>
<h3 id="Rule_7:_Avoid_CSS_Expressions(避免CSS表达式)">Rule 7: Avoid CSS Expressions(避免CSS表达式)</h3><ul>
<li><strong><em>Working Around the Problem</em></strong><br>如果需要动态改变样式，可以使用事件处理器。</li>
</ul>
<h3 id="Rule_8:_Make_JavaScript_and_CSS_External(使用外部JavaScript和CSS)">Rule 8: Make JavaScript and CSS External(使用外部JavaScript和CSS)</h3><ul>
<li><strong><em>Inline</em></strong><br>内联快一些。</li>
<li><strong><em>Component Reuse</em></strong><br>如果你的网站中的每个页面或者多个页面都使用了相同的JavaScript和CSS，使用外部文件可以提高这些组件的重用性，这时，使用外部文件更加具有优势。</li>
<li><strong><em>Post-Onload Download</em></strong><br>我们希望为主页内联JavaScript和CSS，但又能为所有后续页面查看提供外部文件。这时可以通过在主页加载完成后动态下载外部组件来实现(通过onload事件)，这能够将外部文件放到浏览器的缓存中以便用户接下来访问其他页面。<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doOnload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    setTimeout(downloadComponents(),<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadComponents</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    downloadJS(<span class="string">'http://xxx/xxx.js'</span>);</span><br><span class="line">    downloadCSS(<span class="string">'http://xxx/xxx.css'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadJS</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> elem = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</span><br><span class="line">    elem.src = url;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">downloadCSS</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> elem = <span class="built_in">document</span>.createElement(<span class="string">'link'</span>);</span><br><span class="line">    elem.rel = <span class="string">'stylesheet'</span>;</span><br><span class="line">    elem.type = <span class="string">'text/css'</span>;</span><br><span class="line">    elem.href = url;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(elem);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">window</span>.onload = doOnload;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Rule_9:_Reduce_DNS_lookups(减少DNS查找)">Rule 9: Reduce DNS lookups(减少DNS查找)</h3><ul>
<li><strong><em>DNS Caching and TTLs</em></strong><br>DNS查找可以被缓存起来以提高性能。<br>在用户请求一个主机名之后，DNS信息会留在操作系统的DNS缓存中，之后对于该主机名的请求将无需进行过多的DNS查找。<br>很多浏览器拥有其自己的缓存，和操作系统的缓存相分离。只要浏览器在其缓存中保留了DNS记录，它就不会麻烦操作系统来请求这个记录。</li>
</ul>
<h3 id="Rule_10:_Minify_JavaScript(精简JavaScript)">Rule 10: Minify JavaScript(精简JavaScript)</h3><ul>
<li><strong><em>Minification</em></strong><br>精简，是从代码中移除不必要的字符以减少其大小，所有的注释以及不必要的空白字符将被移除。</li>
<li><strong><em>Obfuscation</em></strong><br>混淆，同精简一样，它也会移除注释和空白，但同时它也会改写代码，它会使用更短的变量和函数名字替换原有内容。</li>
<li><strong><em>Gzip and Minification</em></strong><br>使用gzip压缩文件，通常可以使文件大小减小70%，压缩比精简更能减小文件的大小。而且，混淆压缩与精简压缩，效率几乎一样。但使用精简可以避免混淆带来的额外风险。</li>
<li><strong><em>Minifying CSS</em></strong><br>优化CSS，最大的潜在可能是，合并相同的类、移除不使用的类等。目前的解决方案是移除注释和空白，并进行一些直观的优化，比如使用缩写(‘#ccc’代替’#cccccc’)和移除不必要的字符串，如用’0’代替’0px’。</li>
</ul>
<h3 id="Rule_11:_Avoid_Redirects(避免重定向)">Rule 11: Avoid Redirects(避免重定向)</h3><ul>
<li><strong><em>Types of Redirects</em></strong><br>重定向请求的响应中会包含一个范围在3xx的状态码。’304 Not Modified’并不是真的重定向–它是用来响应条件GET请求，避免下载已经存在于浏览器缓存中的数据。状态码’306’已经被废弃。</li>
<li><strong><em>How Redirects Hurt Performance</em></strong><br>第一次请求URL时，接收到3xx重定向，然后请求此时的新url，而且可能会多次重定向，此时直到请求到预期想请求的资源已经经过了好几次http请求，影响性能。</li>
</ul>
<h3 id="Rule_12:_Remove_Duplicate_Scripts(移除重复脚本)">Rule 12: Remove Duplicate Scripts(移除重复脚本)</h3><ul>
<li><strong><em>Duplicate Scripts Hurt Performance</em></strong><br>重复脚本损伤性能的方式有两种–不必要的HTTP请求和执行JavaScript所浪费的时间。</li>
</ul>
<h3 id="Rule_13:_Configure_ETags(配置ETag)">Rule 13: Configure ETags(配置ETag)</h3><ul>
<li><strong><em>What’s an ETag</em></strong><br>实体标签，是Web服务器和浏览器用于确认缓存组件的有效性的一种机制，在HTTP1.1中引入。</li>
<li><strong><em>Last Modified Date</em></strong><br>服务器通过Last-Modified响应头来返回组件的最新修改日期，下一次请求资源时，浏览器会使用If-Modified-Since头将最新修改日期传回到服务器以进行比较。<br>如果服务器上组件的最新修改日期与浏览器传回的值匹配，会返回一个304响应，而不会传送当前浏览器请求的资源。</li>
<li><strong><em>The Problem with ETags</em></strong><br>当浏览器从一台服务器上获取了原始组件，之后又向另外一台不同的服务器发起GET请求时，ETag是不会匹配的，这对于使用服务器集群来处理请求的网站来说，是很常见的一种情况。</li>
</ul>
<h3 id="Rule_14:_Make_Ajax_Cacheable(使Ajax可缓存)">Rule 14: Make Ajax Cacheable(使Ajax可缓存)</h3><ul>
<li><strong><em>Optimizing Ajax Requests</em></strong><br>当用户发起主动Ajax请求时，用户可能仍须等待，要改善性能，可以优化这些请求。</li>
<li><strong><em>Caching Ajax in the Real World</em></strong><br>一个例子，Yahoo Mail。当用户启动Yahoo Mail的Ajax版本时，它会下载前三个Email消息的正文，这是一个聪明的主动Ajax请求，用户很有可能单击这些Email消息中的一个或几个，<br>它们已经被下载到客户端，这样用户无需进行任务Ajax请求就能看到他们的Email消息。</li>
</ul>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/29/兼容AMD-CMD-CommonJS-Node-多种模块规范/" itemprop="url">
                  实现兼容AMD/CMD/Node多种模块规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-02-29T22:43:01+08:00" content="2016-02-29">
              2016-02-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/02/29/兼容AMD-CMD-CommonJS-Node-多种模块规范/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/29/兼容AMD-CMD-CommonJS-Node-多种模块规范/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>在JavaScript社区，CommonJS规范的提出，是模块化方面最重要的一笔。</p>
<h3 id="CommonJS的模块实现">CommonJS的模块实现</h3><p>CommonJS的模块引用使用require，如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="Node的模块实现">Node的模块实现</h3><p>在Node中引入模块，需要经过下面3个步骤：</p>
<ul>
<li>路径分析；</li>
<li>文件定位；</li>
<li>编译执行。</li>
</ul>
<p>主要用require()方法来查找模块。</p>
<h3 id="AMD规范">AMD规范</h3><p>AMD全称Asynchronous Module Definition，即“异步模块定义”。其模块引用方式如下：<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span>(<span class="title">id</span>?,dependencies?,factory);</span><br></pre></td></tr></table></figure></p>
<p>其中，id及依赖是可选的。其与CommonJS方式相似的地方在于factory的内容就是实际代码的内容，下面是一个简单的例子：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> exports = &#123;&#125;;</span><br><span class="line">	exports.sayHello = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">		alert(<span class="string">'hello'</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">	<span class="keyword">return</span> exports;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h3 id="CMD规范">CMD规范</h3><p>CMD由国内大神玉伯提出，与AMD类似，区别主要在于定义模块和依赖引入的地方。AMD需要在声明模块时指定所有的依赖，通过形参传递依赖到模块内容中：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'dep1'</span>,<span class="string">'dep2'</span>],<span class="function"><span class="keyword">function</span><span class="params">(dep1,dep2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>与AMD相比，CMD更接近Node对CommonJS规范的定义：<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">define</span>(<span class="title">factory</span>);</span><br></pre></td></tr></table></figure></p>
<p>在依赖部分，CMD支持动态引入，如下：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span><span class="params">(<span class="keyword">require</span>,exports,<span class="keyword">module</span>)</span><span class="comment">&#123;</span><br><span class="line">	// Todo</span><br><span class="line">&#125;</span>);</span></span><br></pre></td></tr></table></figure></p>
<p>require、exports、module通过形参传递给模块，在需要依赖模块时，随时调用require引入即可。</p>
<h3 id="兼容多种模块规范">兼容多种模块规范</h3><p>为了让同一个模块可以运行在前后端，在开发过程中需要考虑兼容前后端问题，以下代码演示如何将hello()方法定义到不同的运行环境中，它能够兼容AMD、CMD、Node以及常见的浏览器环境中：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">name, definition</span>) </span>&#123;</span><br><span class="line">   	<span class="comment">// 检测上下文环境是否为AMD或CMD</span></span><br><span class="line">   	<span class="keyword">var</span> hadDefine = <span class="keyword">typeof</span> define === <span class="string">'function'</span>,</span><br><span class="line">   	<span class="comment">// 检测上下文环境是否为Node</span></span><br><span class="line">   		hasExports = <span class="keyword">typeof</span> <span class="built_in">module</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">module</span>.exports;</span><br><span class="line">   	<span class="keyword">if</span> (hadDefine) &#123;</span><br><span class="line">   		<span class="comment">// AMD/CMD</span></span><br><span class="line">   		define(definition);</span><br><span class="line">   	&#125;</span><br><span class="line">   	<span class="keyword">else</span> <span class="keyword">if</span> (hasExports) &#123;</span><br><span class="line">   		<span class="comment">// Node</span></span><br><span class="line">   		<span class="built_in">module</span>.exports = definition();</span><br><span class="line">   	&#125;</span><br><span class="line">   	<span class="keyword">else</span> &#123;</span><br><span class="line">   		<span class="comment">// 将模块的执行结果挂在全局变量(window)中</span></span><br><span class="line">   		<span class="keyword">this</span>[name] = definition();</span><br><span class="line">   	&#125;</span><br><span class="line">   &#125;)(<span class="string">'hello'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   	<span class="keyword">var</span> hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">   	<span class="keyword">return</span> hello;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure></p>
<p>以上信息主要摘自书籍《深入浅出Nodejs》，有兴趣的朋友可以自己尝试前台、后台模块引入的异同，或者尝试这几种模块引入方式的异同。</p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/20/用cookie校验账户登录/" itemprop="url">
                  angular+node项目中用cookie校验账户登录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-02-20T19:10:08+08:00" content="2016-02-20">
              2016-02-20
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/02/20/用cookie校验账户登录/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/20/用cookie校验账户登录/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>最近的新项目中，用户登录需要采用cookie来记住用户，校验身份。</p>
<h3 id="在header中携带authId登录">在header中携带authId登录</h3><p>在之前老的项目里，没有采用cookie来记录用户登录状态，而是在请求的header中携带一个身份标识来校验，大致方案如下：</p>
<ul>
<li>客户端使用post请求提交user、password给服务端进行登录操作；</li>
<li>服务端校验用户是否合法，如果合法将产生一个唯一的身份标识authId，返回给客户端，客户端将此authId存放本地(如localStorage)；</li>
<li>客户端在每次需要校验身份的请求中，往header中加入这个authId；</li>
<li>服务端检测当前的authId是否有效，有效则表示当前用户合法，允许操作；</li>
<li>客户端用户登出的时候，发送一个delete请求，告诉服务端用户注销，同时删除本地的authId信息；</li>
<li>服务端收到注销请求后，删除当前的authId数据。</li>
</ul>
<p>上面的方案，如果其他客户端知道了这个authId后，可以在其他客户端模拟身份，不安全，因此弃用。</p>
<h3 id="用cookie记住用户">用cookie记住用户</h3><p>新项目中，将采用此文即将介绍的方案–利用cookie来记住用户。主要流程是：</p>
<ul>
<li>客户端使用post请求提交user、password给服务端进行登录操作；</li>
<li>服务端校验用户是否合法，如果合法将产生一个唯一的身份标识authId，以cookie的形式返回给客户端；</li>
<li>客户端再次请求服务端时，会携带此前已经拿到的cookie给服务端，服务端校验是否合法，合法则可以继续操作；</li>
<li>客户端用户登出的时候，发送一个delete请求，告诉服务端用户注销，服务端删除登录标识。<br>整个过程可以用下面这张图简单表示：<br><img src="../../../../images/20160220/a.png" alt="cookie传递流程图"></li>
</ul>
<p>前台用angular搭建单页客户端应用，后台用node搭建服务器，数据存放在mongodb中，这三个技术及cookie基础知识本文不做介绍，感兴趣的同学可以自行了解。<br>以下的代码都是最简单的get/post请求，但也是最核心的部分，其他有关登录的繁琐操作，感兴趣的同学可以自行补充。</p>
<h3 id="从开始–&gt;结束，遇到的问题">从开始–&gt;结束，遇到的问题</h3><p>首先，我用的是最基础的post请求，服务端也只是简单的返回数据，部分简单但比较核心的代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client</span></span><br><span class="line">$http(&#123;</span><br><span class="line">		 method         : <span class="string">'POST'</span>,</span><br><span class="line">		 url            : <span class="string">'http://127.0.0.1:8888/rest/user'</span>,</span><br><span class="line">		 data           : &#123;name: <span class="string">'xxx'</span>,password:<span class="string">'***'</span>&#125;</span><br><span class="line">	  &#125;).success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'login success,data is:'</span>+data);</span><br><span class="line">&#125;).error(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'login error'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">var</span> cookie = <span class="string">"authId="</span> + authId;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json;charset=utf-8'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, cookie + <span class="string">';Max-Age=3600;HttpOnly=false;Path=/;'</span>);</span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure></p>
<p>查看chrome调试，发现虽然服务端的cookie推过来了，但整体出了问题，提示如下：<br><img src="../../../../images/20160220/01.png" alt="不能跨域"><br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XMLHttpRequest cannot load http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8888</span>/rest/user. Response <span class="keyword">to</span> preflight request doesn<span class="attribute">'t</span> pass <span class="keyword">access</span> control check: No <span class="attribute">'Access</span>-Control-Allow-Origin' header <span class="keyword">is</span> present <span class="keyword">on</span> the requested resource. Origin <span class="attribute">'http</span>://localhost:<span class="number">62427</span>' <span class="keyword">is</span> therefore <span class="keyword">not</span> allowed <span class="keyword">access</span>.</span><br></pre></td></tr></table></figure></p>
<p>分析问题后，发现原因是来自客户端的请求不能跨域访问服务端的请求，请求的资源header中没有携带允许跨越请求的信息。根据这个提示，我们把服务端的代码稍加改进后，如下：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">var</span> cookie = <span class="string">"authId="</span> + authId;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json;charset=utf-8'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, cookie + <span class="string">';Max-Age=3600;HttpOnly=false;Path=/;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加允许跨越的头信息</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'GET,PUT,POST,DELETE,OPTIONS'</span>);</span><br><span class="line"></span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure></p>
<p>解释下上面代码什么意思，第一句主要是允许来自任何域的请求访问，第二句是允许哪些类型的请求访问。加上后再次运行，提示如下：<br><img src="../../../../images/20160220/02.png" alt="没有携带支持Content-Type"><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XMLHttpRequest cannot <span class="operator"><span class="keyword">load</span> <span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8888</span>/rest/<span class="keyword">user</span>. Request header <span class="keyword">field</span> <span class="keyword">Content</span>-<span class="keyword">Type</span> <span class="keyword">is</span> <span class="keyword">not</span> allowed <span class="keyword">by</span> <span class="keyword">Access</span>-Control-<span class="keyword">Allow</span>-Headers <span class="keyword">in</span> preflight response.</span></span><br></pre></td></tr></table></figure></p>
<p>原因是来自客户端的请求中，Content-Type头字段，在服务端的响应信息的头中，没有携带，再次修改代码如下：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">var</span> cookie = <span class="string">"authId="</span> + authId;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json;charset=utf-8'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, cookie + <span class="string">';Max-Age=3600;HttpOnly=false;Path=/;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加允许跨越的头信息</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'GET,PUT,POST,DELETE,OPTIONS'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加支持Content-Type允许的头信息</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Headers'</span>, <span class="string">'Content-Type'</span>);</span><br><span class="line"></span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure></p>
<p>再次运行代码，发现没有错误提示，但是当我们再次请求服务器时，发现客户端的请求并没有携带cookie信息，这显然不是我们想要的效果：<br><img src="../../../../images/20160220/03.png" alt="没有携带cookie的请求"></p>
<p>在查阅了一段时间后了解到，客户端是会默认携带cookie给服务端的，但是当客户端的请求是跨域请求时，由于跨域请求本身就有风险，而携带给cookie同样有风险。<br>因此在进行跨域访问时，客户端不会将服务端返回的cookie携带。此时，我们需要同时在客户端和服务端都设置“withCredentials”为true，代码如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client</span></span><br><span class="line">$http(&#123;</span><br><span class="line">		 method         : <span class="string">'POST'</span>,</span><br><span class="line">		 url            : <span class="string">'http://127.0.0.1:8888/rest/user'</span>,</span><br><span class="line">		 withCredentials: <span class="literal">true</span></span><br><span class="line">		 data           : &#123;name: <span class="string">'xxx'</span>,password:<span class="string">'***'</span>&#125;</span><br><span class="line">	  &#125;).success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'login success,data is:'</span>+data);</span><br><span class="line">&#125;).error(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'login error'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">var</span> cookie = <span class="string">"authId="</span> + authId;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json;charset=utf-8'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, cookie + <span class="string">';Max-Age=3600;HttpOnly=false;Path=/;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加允许跨越的头信息</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'*'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'GET,PUT,POST,DELETE,OPTIONS'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加支持Content-Type允许的头信息</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Headers'</span>, <span class="string">'Content-Type'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置已携带凭证为true</span></span><br><span class="line"><span class="comment">//res.setHeader('Access-Control-Allow-Credentials', true);</span></span><br><span class="line"></span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure></p>
<p>运行后，发现又有错误提示，如下：<br><img src="../../../../images/20160220/04.png" alt="允许跨越不能设置泛型“*”"><br><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XMLHttpRequest cannot load http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8888</span>/rest/user. Response <span class="keyword">to</span> preflight request doesn<span class="attribute">'t</span> pass <span class="keyword">access</span> control check: A wildcard '*' cannot be used <span class="keyword">in</span> the <span class="attribute">'Access</span>-Control-Allow-Origin' header <span class="keyword">when</span> the credentials flag <span class="keyword">is</span> true. Origin <span class="attribute">'http</span>://localhost:<span class="number">62427</span>' <span class="keyword">is</span> therefore <span class="keyword">not</span> allowed <span class="keyword">access</span>.</span><br></pre></td></tr></table></figure></p>
<p>分析错误后发现，原因是当设置了已携带凭证参数为true时，允许跨域请求的源不能设置为泛型的“*”，因此我们再次修改代码如下：(<strong><em>最终代码</em></strong>)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// client</span></span><br><span class="line">$http(&#123;</span><br><span class="line">		 method         : <span class="string">'POST'</span>,</span><br><span class="line">		 url            : <span class="string">'http://127.0.0.1:8888/rest/user'</span>,</span><br><span class="line">		 withCredentials: <span class="literal">true</span></span><br><span class="line">		 data           : &#123;name: <span class="string">'xxx'</span>,password:<span class="string">'***'</span>&#125;</span><br><span class="line">	  &#125;).success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'login success,data is:'</span>+data);</span><br><span class="line">&#125;).error(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'login error'</span>);</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// server</span></span><br><span class="line"><span class="keyword">var</span> cookie = <span class="string">"authId="</span> + authId;</span><br><span class="line">res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json;charset=utf-8'</span>);</span><br><span class="line">res.setHeader(<span class="string">'Set-Cookie'</span>, cookie + <span class="string">';Max-Age=3600;HttpOnly=false;Path=/;'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加允许跨越的头信息</span></span><br><span class="line"><span class="comment">// res.setHeader('Access-Control-Allow-Origin', '*');</span></span><br><span class="line"><span class="comment">// 用当前的客户端origin来取代泛型的“*”</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Origin'</span>, <span class="string">'http://localhost:62427'</span>);</span><br><span class="line"></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Methods'</span>, <span class="string">'GET,PUT,POST,DELETE,OPTIONS'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加支持Content-Type允许的头信息</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Headers'</span>, <span class="string">'Content-Type'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置已携带凭证为true</span></span><br><span class="line">res.setHeader(<span class="string">'Access-Control-Allow-Credentials'</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">res.end();</span><br></pre></td></tr></table></figure></p>
<p>此时，第一次请求服务端时，服务端返回cookie信息，以后每次客户端请求服务端，客户端的header中都会携带cookie信息，效果如下图：<br><img src="../../../../images/20160220/05.png" alt="成功"></p>
<h3 id="最后">最后</h3><p>以上就是在使用cookie记住用户身份时遇到的一些问题及简单解决方法，一般在angular应用中，可能使用较多的是resoure进行http通信，此时只要在GET/POST/PUT/DELETE等请求的参数中，将“withCredentials”设置为true即可。</p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/18/不通过媒介查询也能构建响应式邮件设计/" itemprop="url">
                  不通过媒介查询也能构建响应式邮件设计(译文)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-02-18T11:39:31+08:00" content="2016-02-18">
              2016-02-18
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/02/18/不通过媒介查询也能构建响应式邮件设计/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/18/不通过媒介查询也能构建响应式邮件设计/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>一般来说，我们用媒介查询(Media Queries)来构建响应式邮件设计。但是最近我发现另一种可以构建响应式设计的方案，通过使用CSS的calc()技术与其他三个宽度属性：width、min-width、max-width。</p>
<h3 id="问题">问题</h3><p>创建响应式邮件应用很困难，特别是一些手机客户端应用不支持媒介查询。使用hybird、Gmail邮件应用或者不通过媒介查询来构建响应式邮件设计是三种可选方案。</p>
<p>我最近正在研究第三种方案。一开始我给div元素设置fixed width并且设置display属性为inline-block。一旦屏幕可以容纳两个以上的块，它们将会自然的排列下去，但是我还是遇到了问题。</p>
<p>一旦所有的块开始层叠了，它们就不能占满屏幕宽度。<br><img src="../../../../images/20160218/01.png" alt="无法占满屏宽"><br>我花了很长一段时间去寻找解决这个问题的方案，Flexbox是一个不错的建议，但不幸的是，电子邮件对Flexbox的支持很差。</p>
<h3 id="一种解决方案">一种解决方案</h3><h5 id="记住width、min-width、max-width"><strong><em>记住width、min-width、max-width</em></strong></h5><p>紧接着calc()函数，我在这个方案中引入了三个CSS属性。为了更好的理解它是怎么工作的，我们先来回顾下width、min-width、max-width同时使用时在前台页面中是如何表现的。</p>
<ul>
<li>如果width属性值比max-width大，max-width属性生效</li>
<li>如果min-width属性值比width或者max-width属性值大，则min-width属性生效</li>
</ul>
<p>你先猜猜下面这个盒子的样式，宽度会是多少？<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.box</span> <span class="rules">&#123;</span><br><span class="line">       <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">320px</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">min-width</span>:<span class="value"><span class="number">480px</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">max-width</span>:<span class="value"><span class="number">160px</span></span></span>;</span><br><span class="line">   &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>答案：盒子宽度将会是480px</p>
<h5 id="calc()"><strong><em>calc()</em></strong></h5><p>不再啰嗦，下面演示如何用这种方案创建在宽度屏幕宽度小于480px的情况下会自动堆积为两列。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.block</span> <span class="rules">&#123;</span><br><span class="line">       <span class="rule"><span class="attribute">display</span>:<span class="value">inline-block</span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">min-width</span>:<span class="value"><span class="number">50%</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">max-width</span>:<span class="value"><span class="number">100%</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="function">calc</span>((<span class="number">480px</span> — <span class="number">100%</span>) * <span class="number">480</span>)</span></span>;</span><br><span class="line">   &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>我们一个个分析这几个属性。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">min-width</span>:<span class="number">50%</span>;</span><br></pre></td></tr></table></figure></p>
<p>min-width属性定义的列宽可以让我们在桌面端使用，我们可以改变这个值来添加更多的列，如：改变为25%来显示四列，或者用fixed pixed宽度来设置列宽属性。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">max-width</span>:<span class="number">100%</span>;</span><br></pre></td></tr></table></figure></p>
<p>max-width属性定义的列宽可以让我们在手机端使用，由于设置为100%，每列宽都将自适应，撑满容器的宽度。我们也可以改变属性值来在手机端显示多列。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">width:calc((<span class="number">480</span>px — <span class="number">100</span>%) * <span class="number">480</span>);</span><br></pre></td></tr></table></figure></p>
<p>多亏了calc()函数，可以给width属性变魔法。值480是我们希望的转换点，值100%表示父容器的宽度，计算的结果为一个比max-width更大或者比min-width更小的值，因此这两个属性中的一个一定会生效并取代width属性。下面是两个例子：<br><img src="../../../../images/20160218/02.png" alt="parent width 500px"><br>父元素宽度500px的情况下，计算出来的宽度为-9600px，比min-width要小，因此min-width生效，宽度为50%，呈现两列布局。<br><img src="../../../../images/20160218/03.png" alt="parent width 400px"><br>父元素宽度400px的情况下，计算出来的宽度为38400px，远比min-width大，但max-width比它小，因此max-width生效，呈现单列布局。</p>
<h3 id="支持情况">支持情况</h3><p>在浏览器端，IE9已经开始支持calc()函数。而且在电子邮件客户端，calc()函数也得到了良好的支持。同时，在Apple Mail(IOS/OS X)、Thunderbird、Outlook(IOS/Android apps)、Gmail(webmail/IOS/Android apps)、AOL(webmail)和老的Outlook.com也能生效。</p>
<h5 id="老的Outlook-com"><strong><em>老的Outlook.com</em></strong></h5><p>Outlook.com有一点小瑕疵，就是在calc()函数中会过滤每一个包含括号的属性。这就意味着，支持“calc(480px-100%)”，但不支持calc((480px-100%)*480)。因此我们需要像下面这样改变写法来支持老的Outlook.com：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">width:calc(<span class="number">480</span>px * <span class="number">480</span> — <span class="number">100</span>% * <span class="number">480</span>);</span><br></pre></td></tr></table></figure></p>
<h5 id="不支持的客户端"><strong><em>不支持的客户端</em></strong></h5><p>calc()函数在一些老的电子邮件客户端像Lotus Notes及最新Windows版本的Outlook是不被支持的。同时，在Outlook Web App和Yahoo也不被支持。这些应用中的calc()函数将会被忽略掉。</p>
<h5 id="让步(兼容处理)"><strong><em>让步(兼容处理)</em></strong></h5><p>在这种情况下，我建议使用fixed width引入一些自定义属性来兼容那些不支持calc()函数的客户端。为了在这些客户端隐藏这几个属性，尽管可能不会生效，我还是建议用calc()函数，下面是第一个例子：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.block</span> <span class="rules">&#123;</span><br><span class="line">       <span class="rule"><span class="attribute">display</span>:<span class="value">inline-block</span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">min-width</span>:<span class="value"><span class="number">240px</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">50%</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">max-width</span>:<span class="value"><span class="number">100%</span></span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">min-width</span>:<span class="value"><span class="function">calc</span>(<span class="number">50%</span>)</span></span>;</span><br><span class="line">       <span class="rule"><span class="attribute">width</span>:<span class="value"><span class="function">calc</span>(<span class="number">480px</span> * <span class="number">480</span> — <span class="number">100%</span> * <span class="number">480</span>)</span></span>;</span><br><span class="line">   &#125;</span></span><br></pre></td></tr></table></figure></p>
<h5 id="Outlook_Web_App"><strong><em>Outlook Web App</em></strong></h5><p>然而，Outlook Web App(包括Offiec 365及新的Outlook.com)还有一个自带的小瑕疵。当calc()函数包含乘法(*)，新的Outlook.com及Office 365将会删除整个对应的内联样式属性。这就意味着我们需要手动计算乘法，并使用计算后的结果。下面是在480px转折点计算乘法后的结果：<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">width</span><span class="value">:<span class="function">calc</span>(<span class="number">230400px</span> — <span class="number">48000%</span>);</span></span><br></pre></td></tr></table></figure></p>
<h5 id="WebKit前缀(WebKit_Prefixes)"><strong><em>WebKit前缀(WebKit Prefixes)</em></strong></h5><p>老版本的Android(&lt;Android 5.0)及IOS(&lt;IOS 7)需要加上WebKit前缀以生效。因此我们最终的结果如下：<br>.block {<br>    display:inline-block;<br>    min-width:240px;<br>    width:50%;<br>    max-width:100%;<br>    min-width:-webkit-calc(50%);<br>    min-width:calc(50%);<br>    width:-webkit-calc(230400px — 48000%);<br>    width:calc(230400px — 48000%);<br>}</p>
<h3 id="缺点及最后的想法">缺点及最后的想法</h3><p>就像在电子邮件开发世界中的任何一件事物一样，上述方案并不完美。下面是一些我能想到的一些局限性：</p>
<ul>
<li>在Yahoo上不管用。其桌面端支持媒介查询，因此我们可以稍加改进，让手机端应用优先，并且在桌面端应用中加入媒介查询来巩固它。</li>
<li>只能设置一个转折点。</li>
<li>你只能从桌面版减少列数到手机版，你不能从四列布局的手机版到单列布局的桌面版，虽然这种情况很少见。</li>
<li>最终的写法很难阅读。使用预处理器和mixin生成所有必需的属性可能会有用的多。</li>
</ul>
<p>不过，我依然认为这个方案在很多情况下会很方便。特别是针对优化Gmail。当然我也确信有很多网站上正在使用的实例。(像小部件、广告等等…)<br>并且我也迫不及待的想看到这种方案会给你的设计激发怎样的灵感。</p>
<p><strong><em>(本文译自：<a href="https://medium.freecodecamp.com/the-fab-four-technique-to-create-responsive-emails-without-media-queries-baf11fdfa848#.tgn1z33if" target="_blank" rel="external">The Fab Four technique to create Responsive Emails without Media Queries</a>)</em></strong></p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/31/2016，拜托自己加油/" itemprop="url">
                  2016，拜托自己加油
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-31T20:39:04+08:00" content="2016-01-31">
              2016-01-31
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/01/31/2016，拜托自己加油/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/31/2016，拜托自己加油/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <h4 id="2016年过去一个月了，才发现。">2016年过去一个月了，才发现。</h4><h3 id="2015">2015</h3><p>简单回忆下2015年我都做了什么吧，给2016年的自己留个念想。</p>
<ul>
<li>01月，醉生梦死。</li>
<li>02月，离开家来到济南。</li>
<li>03月，希望给另一半更好的未来，在夹杂着不舍、迷茫与万般犹豫的思想斗争中，离开济南，来到上海，打拼。</li>
<li>04月，衡量再三，选择一个新领域，开始一份新工作–<strong><em>Front-End Web Developer</em></strong>，学习<strong><em>angular、bootstrap、sass、less</em></strong>。</li>
<li>05月，搬家、接手移动端项目工作，学习<strong><em>ionic</em></strong>、<strong><em>cordova</em></strong>。</li>
<li>06月，飘着小雨的端午节，有不快，更多的还是心情很美妙。工作方面，由于大神离开了，很多东西需要自己摸索，开始学习<strong><em>gulp、restful</em></strong>。</li>
<li>07月，由于新项目的需要，开始学习简单<strong><em>android</em></strong>的知识。</li>
<li>08月，由于新项目的需要，自学一段时间的<strong><em>object-c</em></strong>，玩了一段时间的<strong><em>x-code</em></strong>，期间有一阵看的厌烦，好在最后了解一二，成功给<strong><em>ios</em></strong>应用添加上<strong><em>notification</em></strong>，算是一个在<strong><em>ios</em></strong>端独立完成的完整功能吧。</li>
<li>09月，学习<strong><em>nodejs</em></strong>，了解<strong><em>react</em></strong>相关知识。</li>
<li>10月，学习<strong><em>mongodb</em></strong>，并尝试使用<strong><em>nodejs+mongodb</em></strong>，给自己做简单后台。</li>
<li>11月，发现自己基础比较薄弱，开始把更多的时间用在基础知识的学习，包括<strong><em>JavaScript、CSS、HTML5</em></strong>，玩了一段时间<strong><em>github</em></strong>。</li>
<li>12月，搭建自己<strong><em><a href="https://xishiyi7.github.io" target="_blank" rel="external">个人博客</a></em></strong>。</li>
<li>01月，开始第一篇英文原版<strong><em>post</em></strong>的翻译，译的好渣。</li>
</ul>
<p>生活方面，过去一年对我来说真的很长，庆幸相安无恙的走过来了，或许这就是长大了，需要你去承担和经历的。<br>不过很多时候脾气不好，经常惹人生气，待人处事需要多磨练、学习。四季度明显浮躁了很多，各种任性各种耍脾气，需要坚决改正。</p>
<p>工作方面，新的方向算是新的挑战吧，在前人的基础上，慢慢摸索着学习了一些新的技能，从最开始的陌生到慢慢熟悉。不过到目前为止，很多新知识都没有真正涉足<strong><em>(eg. react/nodejs/mongodb)</em></strong>，只是停留在了解层面，这也跟自己过于浮躁及懒惰有关。</p>
<h3 id="2016">2016</h3><p>虽然2016年已经过去一个月了，而且接下来的几个月会有各种事，但是计划还是要有的，多少执行点，也是赚了旧时光。<br>最期望做的事包括但不仅限于：</p>
<ul>
<li><strong><em>G F</em></strong></li>
<li><strong><em>G F</em></strong></li>
<li><strong><em>G F</em></strong></li>
<li><strong><em>HOUSE</em></strong></li>
<li><strong><em>JOURNEY</em></strong></li>
<li><strong><em>JS/CSS/HTML5</em></strong></li>
<li><strong><em>NODE/MONGODB/REACTJS</em></strong></li>
<li><strong><em>READ POSTS/WRITE POSTS/TRANSLATE POSTS</em></strong></li>
<li><strong><em>IN THE END, THE DAY AFTER THIS YEAR, I WISH I CAN MAKE MY SELF WORTH ￥20,000+/M</em></strong></li>
<li><strong><em>…</em></strong></li>
</ul>
<p>老了，不再敢任性，加油，少年。</p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/20/HTML5使用-pattern-属性进行表单校验/" itemprop="url">
                  HTML5使用'pattern'属性进行表单校验(译文)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-20T09:52:05+08:00" content="2016-01-20">
              2016-01-20
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/01/20/HTML5使用-pattern-属性进行表单校验/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/20/HTML5使用-pattern-属性进行表单校验/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>下面这份指南将会探索HTML5的‘pattern’属性，这个属性可以帮助我们定制我们自己的表单验证。</p>
<h3 id="验证(Validation)">验证(Validation)</h3><p>表单校验在网站的安全性方面启到的作用与网站的实用性是同等重要的。表单校验工作原理是在提交表单之前，评估输入的内容格式是否正确。例如，如果我们有一个邮箱地址框，那填入的信息必须是有效的邮箱地址；它应该是以字母或数字开头，随后是‘@’字符，并以一个域名地址结尾。</p>
<p>HTML5自带的一些新的文本类型极其预先定义好的一些校验规则，例如email、url及tel等，让表单校验变的更加简单。当输入的值与期望输入的格式不匹配时，输入框会抛出一个错误信息来阻止提交。<br><img src="../../../../images/20160120/emaik.png" alt="emaik"><br>预估每一种可能的输入是不切实际的，比如，如果我们需要一个用户名、邮编、或者其他任何格式的特殊输入，我们该怎么办，怎么去校验这些输入呢？这就到了我们今天的主题–’pattern’属性。</p>
<h3 id="使用’Pattern’属性">使用’Pattern’属性</h3><p>‘pattern’属性只对’input’元素有效。我们可以使用正则表达式定义我们自己的校验规则。同样的，如果输入值不满足条件，输入框会抛出一个异常。</p>
<p>例如，加入我们的表格中有一个用户名输入框，因为我们没有针对用户名的校验标准，因此，我们需要使用正则表达式来校验我们的输入内容。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">form</span> action=<span class="string">"somefile.php"</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"text"</span> name=<span class="string">"username"</span> placeholder=<span class="string">"Username"</span>&gt;</span><br><span class="line">   &lt;/<span class="keyword">form</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>下面我们使用’pattern’属性来定义一个规则。假使，我们指定用户名只能由小写字母组成，不允许输入大写字母、数组或者其他特殊字符。另外，用户名的长度不该超过15个字符。用正则来表示的话，规则是’[a-z]{1,15}’。</p>
<p>在我们的用户名输入框中的pattern属性中添加上述值：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">form</span> action=<span class="string">"somefile.php"</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"text"</span> name=<span class="string">"username"</span> placeholder=<span class="string">"Username"</span> pattern=<span class="string">"[a-z]&#123;1,15&#125;"</span>&gt;</span><br><span class="line">   &lt;/<span class="keyword">form</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>好了，现在它只支持输入小写字母，提交任何其他值都会抛出一个错误信息。<br><img src="../../../../images/20160120/username.png" alt="username"><br>就像上面你看到的那样，错误信息是“请按规则输入(Please match the requested format)”。这表示我们的校验生效了，但是，这样的错误信息不利于我们理解我们实际上希望输入怎样的格式。这样的用户体验很失败。</p>
<h3 id="定制校验信息(Customizing_the_Validation_Message)">定制校验信息(Customizing the Validation Message)</h3><p>幸运的是，我们有很多种方式去可以定制更加有用的信息。最直观的方式就是在input元素的’title’属性上添加。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">form</span> action=<span class="string">"somefile.php"</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">input</span></span><br><span class="line">           <span class="keyword">type</span>=<span class="string">"text"</span></span><br><span class="line">           name=<span class="string">"username"</span></span><br><span class="line">           placeholder=<span class="string">"Username"</span></span><br><span class="line">           pattern=<span class="string">"[a-z]&#123;1,15&#125;"</span></span><br><span class="line">           title=<span class="string">"Username should only contain lowercase letters. e.g. john"</span>&gt;</span><br><span class="line">   &lt;/<span class="keyword">form</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在，标题中包含了默认的提示信息：<br><img src="../../../../images/20160120/username1.png" alt="username1"><br>然而，这个信息提示框还是前后不一致。如果我们拿它与一个邮箱格式的输入框相比，实际的说明应该更突出一点。</p>
<p>第二种方案可以帮助我们解决这个问题。</p>
<h3 id="替换默认的校验信息(Replacing_the_Default_Validation_Message)">替换默认的校验信息(Replacing the Default Validation Message)</h3><p>让我们用一个完全自定义的信息来替换默认的“请按规则输入(Please match the requested format)”。我们需要用到一点JavaScript。</p>
<p>开始之前，为了更好的选中input元素，我们先给它加上id。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">form</span> action=<span class="string">"somefile.php"</span>&gt;</span><br><span class="line">       &lt;<span class="keyword">input</span></span><br><span class="line">           <span class="keyword">type</span>=<span class="string">"text"</span></span><br><span class="line">           name=<span class="string">"username"</span></span><br><span class="line">           placeholder=<span class="string">"Username"</span></span><br><span class="line">           pattern=<span class="string">"[a-z]&#123;1,15&#125;"</span></span><br><span class="line">           id=<span class="string">"username"</span>&gt;</span><br><span class="line">   &lt;/<span class="keyword">form</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>现在，我们可以用JavaScript选中元素，并赋值给一个变量。(可以直接使用”script”标签或者引入一个额外的JavaScript文件)<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'username'</span>);</span><br></pre></td></tr></table></figure></p>
<p>然后，当输入框触发校验状态的时候，我们指定特定的信息。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input.oninvalid = <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span><br><span class="line">       event.target.setCustomValidity(<span class="string">'Username should only contain lowercase letters. e.g. john'</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>“oninvalid”事件继承自”event”对象，其包涵有一系列属性，包括”target”属性(校验的元素)及带有错误信息的”validationMessage”属性。<br>在上面的例子中，我们使用”setCustomValidity()”方法替换了提示信息。</p>
<p>现在我们应该可以发现默认的提示信息被无缝替换了。<br><img src="../../../../images/20160120/username3.png" alt="username3"></p>
<h3 id="样式(Styling)">样式(Styling)</h3><p>为了补充新的输入类型及设置一个自定义的验证消息，CSS3规范带来了几个有用的伪类，’:valid’及’:invalid’。这就能够让我们根据不同的输入校验状态应用相应的样式，例如：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">input</span><span class="pseudo">:invalid</span> <span class="rules">&#123;</span><br><span class="line">       <span class="rule"><span class="attribute">border-color</span>:<span class="value"> red</span></span>;</span><br><span class="line">   &#125;</span></span><br><span class="line">   <span class="tag">input</span>,</span><br><span class="line">   <span class="tag">input</span><span class="pseudo">:valid</span> <span class="rules">&#123;</span><br><span class="line">       <span class="rule"><span class="attribute">border-color</span>:<span class="value"> <span class="hexcolor">#ccc</span></span></span>;</span><br><span class="line">   &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>当使用这些伪类时，有几点需要记住的是：</p>
<ul>
<li>首先，”:valid”是默认样式，即使输入值为空。因此，正如上面你看到那样，我们设置”border-color”为”#ccc”，则输入框元素默认的颜色也是这个。空值永远被认为是有效输入，除非我们已经加了“必填”(required)属性。那样的话，输入校验无效，边框将变成给定的红色。</li>
<li>有效和无效样式将在用户输入时立马生效，即使值为空。即时样式改变可能会造成用户的恐慌。</li>
</ul>
<h3 id="弹出框样式一致性(A_Word_on_Styling_the_Popup_Message)">弹出框样式一致性(A Word on Styling the Popup Message)</h3><p>表单校验作为一个HTM5的特性已经变成了一种规范，然而，错误信息提示框如何呈现却完全取决于浏览器厂商。<br>如果在不同的浏览器上呈现不一样的效果，这对你界面的一致性是没有帮助的。<br><img src="../../../../images/20160120/html5-validation-different-browsers.jpg" alt="html5-validation-different-browsers"></p>
<p>谷歌浏览器在几年前阻止用户去自定义默认的弹框。如果你想做啥改变的话，唯一可供选择的方式是使用JavaScript覆盖弹框信息，下面我们来看看应该怎么做。</p>
<h3 id="进阶(Going_More_Advanced)">进阶(Going More Advanced)</h3><p>我们先创建一个当我们的输入值有效的时候才呈现的自定义弹框。在一开始，我们需要选中一些必要的元素，包括”input”及”form”元素：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">'username'</span>);</span><br><span class="line"><span class="keyword">var</span> form  = <span class="built_in">document</span>.getElementById(<span class="string">'form'</span>);</span><br></pre></td></tr></table></figure></p>
<p>然后，新建一个包含我们信息的新元素:<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> elem = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">elem.id  = <span class="string">'notify'</span>;</span><br><span class="line">elem.style.display = <span class="string">'none'</span>;</span><br><span class="line">form.appendChild(elem);</span><br></pre></td></tr></table></figure></p>
<p>上面我们创建了一个新的div元素，设置其id为”notify”，设置其”display”样式为”none”。最后，将其插入到”form”元素中。</p>
<h3 id="使用事件(Working_with_Events)">使用事件(Working with Events)</h3><p>我们需要处理两个事件。首先，当输入的值不合法的时候，需要触发”invalid”事件。下面我们添加”invalid”事件：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">input.addEventListener(<span class="string">'invalid'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span>&#123;</span><br><span class="line">       event.preventDefault();</span><br><span class="line">       <span class="keyword">if</span> ( ! event.target.validity.valid ) &#123;</span><br><span class="line">           elem.textContent   = <span class="string">'Username should only contain lowercase letters e.g. john'</span>;</span><br><span class="line">           elem.className     = <span class="string">'error'</span>;</span><br><span class="line">           elem.style.display = <span class="string">'block'</span>;</span><br><span class="line"></span><br><span class="line">           input.className    = <span class="string">'invalid animated shake'</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure></p>
<p>在这里，利用”event.preventDefault();”，我们可以阻止默认的行为，这样浏览器就不会显示默认的弹框。<br>相反，我们显示新建的div元素。我们在内容区域里添加文本信息，添加新的样式”error”，并且通过设置”display”属性为”block”来显示信息。</p>
<p>同样的，我们给输入框添加一个”invalid”样式，让它边框为红色。我们也需要在样式表中设置其样式：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">input</span><span class="class">.invalid</span> <span class="rules">&#123;</span><br><span class="line">           <span class="rule"><span class="attribute">border-color</span>:<span class="value"> <span class="hexcolor">#DD2C00</span></span></span>;</span><br><span class="line">   &#125;</span></span><br></pre></td></tr></table></figure></p>
<p>另外，你也可以加一些抖动样式通过”Animate.css”，这可以加上一些抖动的动画。</p>
<p>第二个事件是”input”事件，它将在输入值改变的时候触发。我们可以使用这个事件将输入值恢复到合法输入的状态，也可以隐藏弹出框，如下：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">input.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span> ( <span class="string">'block'</span> === elem.style.display ) &#123;</span><br><span class="line">           input.className = <span class="string">''</span>;</span><br><span class="line">           elem.style.display = <span class="string">'none'</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure></p>
<p>如上文，我们可以通过移除input元素的样式来隐藏弹出框。<br>现在我们可以完全定制自己的弹出校验框了，试试输入任何一些非法的值。</p>
<h3 id="最后几点(Final_Thoughts)">最后几点(Final Thoughts)</h3><p>在标准的输入类型中加上pattern属性可以给表单带来一些额外的校验形式，但是请注意，你也应该执行一些服务器端的校验。</p>
<p>神奇的是，即使当用户禁止了浏览器端的JavaScript，最新版的浏览器也会显示校验提示框并阻止表单提交。<br>然而，对于Safari浏览器来说，在用户输入时，不支持pattern属性。不过使用”Webshim Lib”也可以启到类似的效果。</p>
<p>最后，希望你能喜欢本教程，并且将其作为一个针对HTML5表单校验的简单参考指南。<br><strong><em>(本文译自：<a href="http://webdesign.tutsplus.com/tutorials/html5-form-validation-with-the-pattern-attribute--cms-25145/" target="_blank" rel="external">HTML5 Form Validation With the “pattern” Attribute</a>)</em></strong></p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/19/理解JavaScript原型的一个入门指南-译文/" itemprop="url">
                  理解JavaScript原型的一个入门指南(译文)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-19T14:45:14+08:00" content="2016-01-19">
              2016-01-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/01/19/理解JavaScript原型的一个入门指南-译文/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/19/理解JavaScript原型的一个入门指南-译文/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>当我第一次接触到关于JavaScript对象模型的知识,我的反应是震惊的,充满了不可思议.那是我第一次接触基于原型的语言,我被它的原型特征完全搞糊涂了.我不理解把原型加在JavaScript方法的构造函数组成上有啥不同,我敢打赌,你们中的大多数人也曾有过类似的经历.</p>
<p>但是当我经常使用JavaScript之后,我不仅理解了它的对象模型,而且也爱上了它这部分特性.多亏了JavaScript,我才能发现基于原型语言的典雅与灵活.正因为他们比基于类的语言更简单且更灵活,我现在更倾向于原型语言.</p>
<h3 id="JavaScript的原型">JavaScript的原型</h3><p>许多指南介绍JavaScript对象时都以方法的构造函数开始,我认为这是个误区,因为他们在一开始就介绍复杂的内容会让JavaScript看起来很难,一开始就理解的很困惑.让我们后续介绍这个,我们先从原型基础说起.</p>
<h3 id="原型链">原型链</h3><p>在JavaScript中,每一个对象都有原型(prototype)属性,当有一个消息指向对象,JavaScript会先尝试在其寻找对应的属性,<br>如果没有找到,这条消息会被传递到对象的原型上,并依次传递下去.这种工作机制有点像基于类的语言的单亲继承.<br>原型链可以指向任何你想指向的对象,但是一般来说,太长的原型链会让你的代码理解起来很困难并且很难维护.</p>
<h3 id="‘proto‘对象">‘<em>proto</em>‘对象</h3><p>理解JavaScript原型链最简单的就是先理解<em>proto</em>属性,不幸的是,<em>proto</em>属性并不是JavaScript标准的一部分,<br>至少在ES6之前如此.因此你不能在项目代码中应用它,但不管怎么说,它让解释原型变得更简单.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let's create an alien object</span></span><br><span class="line"><span class="keyword">var</span> alien = &#123;</span><br><span class="line">  kind: <span class="string">'alien'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// and a person object</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  kind: <span class="string">'person'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// and an object called 'zack'</span></span><br><span class="line"><span class="keyword">var</span> zack = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// assign alien as the prototype of zack</span></span><br><span class="line">zack.__proto__ = alien</span><br><span class="line"></span><br><span class="line"><span class="comment">// zack is now linked to alien</span></span><br><span class="line"><span class="comment">// it 'inherits' the properties of alien</span></span><br><span class="line"><span class="built_in">console</span>.log(zack.kind); <span class="comment">//=&gt; ‘alien’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// assign person as the prototype of zack</span></span><br><span class="line">zack.__proto__ = person</span><br><span class="line"></span><br><span class="line"><span class="comment">// and now zack is linked to person</span></span><br><span class="line"><span class="built_in">console</span>.log(zack.kind); <span class="comment">//=&gt; ‘person’</span></span><br></pre></td></tr></table></figure></p>
<p>如你所见, <em>proto</em>属性通俗易懂,也很好用.即使我们不能在项目代码中使用它,我也认为这些例子对理解JavaScript对象模型起到很大的帮助.</p>
<p>你可以像如下这样检查一个对象是否是另一个对象的原型:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="function"><span class="title">log</span><span class="params">(alien.isPrototypeOf(zack)</span></span>)</span><br><span class="line"><span class="comment">//=&gt; true</span></span><br></pre></td></tr></table></figure></p>
<h3 id="原型查找是动态的">原型查找是动态的</h3><p>你可以在任何时刻给一个对象的原型添加属性,原型链可以如预期那样找到这个新属性.<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">person</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line">var zack = &#123;&#125;</span><br><span class="line">zack.__proto__ = <span class="keyword">person</span></span><br><span class="line"></span><br><span class="line">// zack doesn't respond to <span class="keyword">kind</span> at this point</span><br><span class="line">console.log(zack.<span class="keyword">kind</span>); //=&gt; undefined</span><br><span class="line"></span><br><span class="line">// let's add <span class="keyword">kind</span> to <span class="keyword">person</span></span><br><span class="line"><span class="keyword">person</span>.<span class="keyword">kind</span> = '<span class="keyword">person</span>'</span><br><span class="line"></span><br><span class="line">// now zack responds to <span class="keyword">kind</span></span><br><span class="line">// because it finds '<span class="keyword">kind</span>' in <span class="keyword">person</span></span><br><span class="line">console.log(zack.<span class="keyword">kind</span>); //=&gt; '<span class="keyword">person</span>'</span><br></pre></td></tr></table></figure></p>
<h3 id="给对象新增/修改的属性,将不会再指向原型">给对象新增/修改的属性,将不会再指向原型</h3><p>如果你给对象添加一个在原型上已经存在的属性,会发生什么呢?我们来看一下:<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">person</span> = &#123;</span><br><span class="line">  <span class="keyword">kind</span>: '<span class="keyword">person</span>'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var zack = &#123;&#125;</span><br><span class="line">zack.__proto__ = <span class="keyword">person</span></span><br><span class="line"></span><br><span class="line">zack.<span class="keyword">kind</span> = 'zack'</span><br><span class="line"></span><br><span class="line">console.log(zack.<span class="keyword">kind</span>); //=&gt; 'zack'</span><br><span class="line">// zack now has a '<span class="keyword">kind</span>' property</span><br><span class="line"></span><br><span class="line">console.log(<span class="keyword">person</span>.<span class="keyword">kind</span>); //=&gt; '<span class="keyword">person</span>'</span><br><span class="line">// <span class="keyword">person</span> has not being modified</span><br></pre></td></tr></table></figure></p>
<p>注意,属性’kind’现在同时存在于person与zack.</p>
<h3 id="Object-create">Object.create</h3><p>正如我说的,由于分配给对象原型的<em>proto</em>属性并不被良好支持,因此下一个最简单的方式是使用Object.create().<br>这个在ES5中已经支持,但是在一些老的浏览器或者引擎中需要使用es5-shim来转换.<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var <span class="keyword">person</span> = &#123;</span><br><span class="line">  <span class="keyword">kind</span>: '<span class="keyword">person</span>'</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// creates a new object which prototype <span class="keyword">is</span> <span class="keyword">person</span></span><br><span class="line">var zack = Object.create(<span class="keyword">person</span>);</span><br><span class="line"></span><br><span class="line">console.log(zack.<span class="keyword">kind</span>); // =&gt; ‘<span class="keyword">person</span>’</span><br></pre></td></tr></table></figure></p>
<p>你可以使用Object.create方法去创建一个新对象,并将另一个对象及一些特殊属性当参数传递进去.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> zack = <span class="built_in">Object</span>.create(person, &#123;age: &#123;value:  <span class="number">13</span>&#125; &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(zack.age); <span class="comment">// =&gt; ‘13’</span></span><br></pre></td></tr></table></figure></p>
<p>是的,你需要传递对象有一点绕,但这就是它的用法.如果你想了解更多,点击<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create" target="_blank" rel="external">这里</a></p>
<h3 id="Object-getPrototype">Object.getPrototype</h3><p>你可以使用Object.getPrototypeOf方法去获取对象的原型<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> zack = <span class="built_in">Object</span>.create(person);</span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(zack); <span class="comment">//=&gt; person</span></span><br></pre></td></tr></table></figure></p>
<p>注意没有所谓的Object.setPrototype.</p>
<h3 id="构造器函数(Constructor_Functions)">构造器函数(Constructor Functions)</h3><p>在JavaScript中,构造器函数用的最多的地方就是用在构造原型链上.<br>构造器函数的流行来自于这样一个事实:它是唯一的一种针对构造类型最原始的方式.<br>当然还有其他一个重要的事实是其他很多引擎已经高度支持构造器函数.</p>
<p>不幸的是,这让人很困惑.在我看来,这是我觉得JavaScript让菜鸟很困惑的一个主要原因.<br>因此这也是这门语言中很大的一个需要我们去很好理解并掌握的模块.</p>
<h3 id="函数作为构造器">函数作为构造器</h3><p>JavaScript中,你可以像下面这样创建一个函数的实例:<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function<span class="function"> Foo(</span><span class="function">)</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">var foo =<span class="instruction"> new </span>Foo(<span class="function">)</span>;</span><br><span class="line"></span><br><span class="line">//foo is now an<span class="instruction"> instance </span>of Foo</span><br><span class="line">console.log(foo instanceof Foo <span class="function">)</span> //=&gt; true</span><br></pre></td></tr></table></figure></p>
<p>像这样使用’new’关键字,看似用工厂模式新建一个函数,实际上表示创建一个新对象.这个新对象的原型会指向这个函数,<br>这里以后再详述.因此在JavaScript中,我们把’this’称作函数实例.</p>
<h3 id="‘this’是隐式分配的">‘this’是隐式分配的</h3><p>当我们使用’new’关键字时,JavaScript以’this’关键字的形式注入一个指向新对象的隐式引用.而且,在函数最后,将这个隐式引用返回.<br>当我们像下面这样时:<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.kind = ‘foo’</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo();</span><br><span class="line">foo.kind <span class="comment">//=&gt; ‘foo’</span></span><br></pre></td></tr></table></figure></p>
<p>在这个场景后面,又像是在做下面这件事情:<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="keyword">this</span> = &#123;&#125;; <span class="comment">// this is not valid, just for illustration</span></span><br><span class="line">  <span class="keyword">this</span>.__proto__ = Foo.prototype;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.kind = ‘foo’</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但是请记住,当只有使用’new’关键字时,才将隐式的’this’分配到新对象上.如果你忘记使用’new’关键字,’this’将指向全局对象(global object).<br>忘记使用’new’关键字会引起一系列bug,因此不要忘记使用’new’关键字.</p>
<p>有一个我比较喜欢的约定是当这个函数要被当成函数构造器使用的时候,有效利用函数的第一个字母(译者注:一般我习惯首字母大写),<br>这样可以很直观的发现你忘记了’new’关键字.</p>
<h3 id="函数的原型属性(The_‘function_prototype’)">函数的原型属性(The ‘function prototype’)</h3><p>在JavaScript中,每一个函数都有一个特殊的属性:’prototype’.<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span><span class="params">()</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Foo.prototype</span><br></pre></td></tr></table></figure></p>
<p>尽管听起来可能很费解,这个’prototype’属性并不是函数的原型.<br><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">Foo.__proto__</span> === Foo.prototype <span class="comment">//=&gt; false</span></span><br></pre></td></tr></table></figure></p>
<p>当然,使用’prototype’表示不一样的东西会引起人们很多疑问.<br>我认为当表示函数的’prototype’属性的时候,称之为’函数的原型属性’(‘the function prototype’)而不仅仅是原型<br>可以做到更好的区分.</p>
<p>当使用’new’关键字创建对象, 新对象的原型会指向函数的原型属性(‘prototype’ property).<br>困惑吧?下面的例子可以更好的解释:<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span><span class="params">(name)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// the function person has a prototype property</span></span><br><span class="line"><span class="comment">// we can add properties to this function prototype</span></span><br><span class="line">Person.prototype.kind = ‘person’</span><br><span class="line"></span><br><span class="line"><span class="comment">// when we create a new object using new</span></span><br><span class="line"><span class="keyword">var</span> zack = <span class="keyword">new</span> Person(‘Zack’);</span><br><span class="line"></span><br><span class="line"><span class="comment">// the prototype of the new object points to person.prototype</span></span><br><span class="line">zack.__proto__ == Person.prototype <span class="comment">//=&gt; true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// in the new object we have access to properties defined in Person.prototype</span></span><br><span class="line">zack.kind <span class="comment">//=&gt; person</span></span><br></pre></td></tr></table></figure></p>
<p>上面就是关于JavaScript对象模型你最需要了解的一些知识,理解<em>proto</em>及function.prototype的关系会给你无尽的乐趣及满足,<br>当然也许并不会.</p>
<p>最后,如果有不对的地方,或者你有什么不解,请留言联系.<br><strong><em>(本文译自：<a href="http://sporto.github.io/blog/2013/02/22/a-plain-english-guide-to-javascript-prototypes/" target="_blank" rel="external">A Plain English Guide to JavaScript Prototypes</a>)</em></strong></p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/18/angular跨controller传递参数的几种方式/" itemprop="url">
                  angular跨controller传递参数的几种方式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            发表于
            <time itemprop="dateCreated" datetime="2016-01-18T11:01:42+08:00" content="2016-01-18">
              2016-01-18
            </time>
          </span>

          

          
            
              <span class="post-comments-count" style="display:none">
                &nbsp; | &nbsp;
                <a href="/2016/01/18/angular跨controller传递参数的几种方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/01/18/angular跨controller传递参数的几种方式/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody">
            
              <p>由于controllers之间不共享scope,如果希望在controllers之间传递参数,可能需要通过其他的方式实现,<br>以下是当前我用到的两种在controllers之间传递参数的方法.<br><em>注:参考文章<a href="http://code.tutsplus.com/courses/sharing-data-between-angular-controllers" target="_blank" rel="external">Sharing Data Between Angular Controllers</a></em></p>
<h5 id="service">service</h5><p>可以写一个包含get/set的service,取参数/赋参数</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.factory('paramService',function()&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="literal">result</span>:[],</span><br><span class="line">		getResult:function()&#123;</span><br><span class="line">			<span class="keyword">return</span> this.<span class="literal">result</span>;</span><br><span class="line">		&#125;,</span><br><span class="line">		setResult:function(res)&#123;</span><br><span class="line">			this.<span class="literal">result</span> = res;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后可以在controllerOne中赋值,在controllerTwo中取值<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 赋值</span></span><br><span class="line">.controller(<span class="string">'one'</span>,<span class="function"><span class="keyword">function</span><span class="params">(paramService)</span></span>&#123;</span><br><span class="line">	paramService.setResult(<span class="string">'one'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取值</span></span><br><span class="line">.controller(<span class="string">'two'</span>,<span class="function"><span class="keyword">function</span><span class="params">(paramService)</span></span>&#123;</span><br><span class="line">	<span class="keyword">var</span> param = paramService.getResult();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h5 id="$stateParams">$stateParams</h5><p>第二种方法用于路由间传递参数,用途也比较广泛,使用场景比较多</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 传参</span><br><span class="line">.state(<span class="string">'one'</span>,&#123;</span><br><span class="line">	url:<span class="string">'one'</span>,</span><br><span class="line">	controller:<span class="string">'one'</span>,</span><br><span class="line">	template:<span class="string">'one.html'</span>,</span><br><span class="line">	params:&#123;</span><br><span class="line">		name:<span class="string">'john'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 取参</span><br><span class="line">.controller(<span class="string">'one'</span>,<span class="keyword">function</span>(<span class="variable">$stateParams</span>)&#123;</span><br><span class="line">	var name = <span class="variable">$stateParams</span>.name;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="others/localStorage">others/<em>localStorage</em></h5><p>其他方法可以使用一些h5的小技巧,比如使用<strong><em>localStorage</em></strong>来存参/取参,其他的方法,暂时没想到也没用到,有待后续补充.</p>
<hr>
<hr>
<p><img src="../../../../images/money.png" alt="money">☜☜☜ <strong><em>wechat</em></strong> 『『『<strong><em> reward 点击扫码打赏 ~~~ ^_^ </em></strong>  』』』<strong><em>alipay</em></strong> ☞☞☞   <img src="../../../../images/money.jpg" alt="money"></p>
<hr>
<hr>

            
          </span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    

  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



        </div>

        


        

      </div>

      
        
  
  <div class="sidebar-toggle" >
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="xishiyi7" itemprop="image"/>
          <p class="site-author-name" itemprop="name">xishiyi7</p>
        </div>
        <p class="site-description motion-element" itemprop="description">this is my personal post</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">标签</span>
              
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xishiyi7</span>
</div>
<!-- 隐藏部分footer
<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>
-->


      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"xishiyi7"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     


    
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  

  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
